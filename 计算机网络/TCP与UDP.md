# TCP与UDP

## TCP和UDP

### TCP是面向连接的、可靠的流协议。

- 流是不间断的数据结构，可以把它想象成水流。
- TCP为提供可靠性传输，实行“顺序控制”或“重发机制”，还具备“流量控制”、“拥塞控制”。

### UDP是不具有可靠性的数据报协议。

- UDP并不保证消息一定会到达。

## TCP和UDP区分（TCP和UDP应该按照需求选择）

### TCP用于在传输层有必要实现可靠传输的情况。

### UDP主要用于那些对于高速传输和实时性有较高要求的通信。

### 一个IP电话的例子

- 如果使用TCP，数据在传输过程中如果丢失会被重发，但这样就无法流畅的传输通话人的声音，会导致无法进行正常交流。
- 如果使用UDP，它不会进行重发处理，也就不会导致声音大幅度延迟到大的情况，虽然有部分数据丢失，但也不会影响整体通信效果。

## UDP（user datagram protocol）

### UDP不提供复杂的控制机制，它利用IP提供面向无连接的通信。

- UDP面向无连接，所以可以随时发送数据。

	- UDP的应用领域

		- 包总量较少的通信，如DNS。
		- 视频、音频等即时通信。

### UDP是面向无连接的服务，它不会检查对端是否可以通信，会直接将数据包发送出去。

## TCP（transimmion control protocol）

### TCP作为一种面向连接的协议，只有在确认通信对端存在时才会发送数据，从而可以控制通信流量的浪费。

### 通过序列号（Seq）与确认应答（ACK）提高可靠性

- 在TCP中，当发送端的数据到达接收主机，接收端主机会受到一个确认应答（ACK）。

	- 网络中的确认应答类似于两个人谈话，当对方听到并理解谈话内容，会返回一个ACK，当对方听到但不理解，会返回一个NACK。
	- 如果发送端在一定时间内未收到确认应答（ACK），发送端就会认为数据已经丢失，会进行重发。

		- 未收到确认应答（ACK）的原因

			- 发送数据丢失
			- 确认应答丢失
			- 确认应答延迟到达

		- 因此有时候接收端会重复收到已接收的数据，所以引入了序列号（Seq）来识别是否已经接收数据。（对已经接收的数据进行丢弃）。

			- 序列号（Seq）是按顺序给发送数据的每一个字节都标上编号的方法。

				- 接收端查询接收数据的TCP首部中的序列号和数据长度，将自己下一步要接收的序列号作为确认应答（ACK）发送出去。

### 重发超时如何确定

- 重发超时是指发送端在发送数据之后，等待确认应答（ACK）的那个时间段。（简单说，重发超时是发送端的等待时间）。
- TCP会计算每次发包的往返时间与其偏差，重发超时就比这个往返时间+偏差的时间稍长一点。

	- 在Unix和Windows系统中，最初的数据包不知道往返时间，所以会把重发超时设置为6秒。

- 如果重发之后还是收不到确认应答，那么会把重发超时以2倍、4倍的方式延长，直到达到一定重发次数之后，发送端强制关闭连接。

### 连接管理

- TCP提供面向连接的服务，面向连接指的是通信开始之前，通信双方先做好通信的准备工作。

	- TCP会在通信之前，通过TCP首部发送一个SYN包作为建立连接的请求，并等待确认应答（ACK）。
	- TCP在断开连接之前会利用TCP首部发送断开连接的FIN包。

*XMind: ZEN - Trial Version*